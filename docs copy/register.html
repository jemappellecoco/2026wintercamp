<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>冬令營報名表 Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN（和 wintercamp 一樣做法） -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <div class="max-w-3xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold mb-2">
      冬令營報名表 Winter Camp Registration
    </h1>
    <p class="text-sm text-slate-300 mb-6">
      請完整填寫以下資料，送出後將寄送報名確認信至您的 Email。
    </p>

    <!-- 成功訊息（如果之後改成 AJAX 可以用） -->
    <div id="successMsg"
         class="hidden mb-4 rounded-lg bg-emerald-600/20 border border-emerald-500 px-4 py-3 text-sm text-emerald-100">
      ✅ 報名已送出，我們已收到您的資料，確認信將寄送至您填寫的 Email。
    </div>

    <!-- 錯誤訊息 -->
    <div id="errorMsg"
         class="hidden mb-4 rounded-lg bg-rose-600/20 border border-rose-500 px-4 py-3 text-sm text-rose-100">
      ⚠ 送出時發生問題，請稍後再試，或聯繫主辦單位。
    </div>
<!-- 報名成功畫面 -->
<div id="successView"
     class="hidden mt-6 text-center bg-white rounded-3xl px-6 py-10 shadow-xl">

  <div class="mx-auto mb-4 h-20 w-20 rounded-full bg-emerald-100 flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
    </svg>
  </div>

  <h2 class="text-2xl font-bold text-slate-800 mb-2">報名成功！</h2>

  <p class="text-sm text-slate-600 leading-relaxed mb-6">
    感謝您的報名，我們會盡快透過 Email 與您聯繫後續繳費事宜。<br>
    請記得查看信箱或垃圾郵件匣。
  </p>

  <button id="nextBtn"
          class="px-6 py-2.5 rounded-xl bg-gradient-to-r from-pink-500 to-purple-600 text-white text-sm font-semibold shadow-md hover:opacity-95">
    填寫下一位
  </button>

  <p class="text-xs text-slate-500 mt-6">
    匯款帳號將於報名成功後發送至您的信箱。<br>
    如有任何疑問，歡迎聯繫我們。
  </p>
</div>

    <!-- 報名表單 -->
    <form id="regForm"
          action="https://script.google.com/macros/s/AKfycbwUAD110dckyhjTintxyJBJf6QxwtLp8S7tEKmck28D7eTtdBUrtH8tZgSWKIh8f_NO/exec"
          method="POST"
          class="space-y-6 bg-slate-900/70 border border-slate-700 rounded-2xl p-6 shadow-xl">

      <!-- 一、基本資料 -->
      <section>
        <h2 class="text-xl font-semibold mb-3">一、報名者基本資料</h2>
        <p class="text-xs text-slate-400 mb-3">
          ※ 為確保活動期間權益與保險辦理，請務必詳實填寫。
        </p>

        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="block text-sm mb-1">學員姓名（必填）</label>
            <input type="text" name="studentName" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">身分證字號（必填，用於保險）</label>
            <input type="text" name="idNumber" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">出生年月日（必填）</label>
            <input type="text" name="birthday" placeholder="例如：2012/03/15"
                   required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">性別（必填）</label>
            <select name="gender" required
                    class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm">
              <option value="">請選擇</option>
              <option value="男">男</option>
              <option value="女">女</option>
              <option value="其他">其他</option>
            </select>
          </div>

          <div>
            <label class="block text-sm mb-1">學校／年級（必填）</label>
            <input type="text" name="schoolGrade" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">聯絡電話（手機，必填）</label>
            <input type="tel" name="phone" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm mb-1">電子郵件 Email（必填）</label>
            <input type="email" name="email" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm"
                   placeholder="報到通知與行前資訊將寄至此信箱" />
          </div>
        </div>
      </section>

      <!-- 一之二、 選擇報名梯次 -->
      <section>
        <h2 class="text-xl font-semibold mb-3">二、選擇報名梯次 <span class="text-rose-500">*</span></h2>
        <p class="text-xs text-slate-400 mb-3">
          可勾選一個或多個梯次，後端將依勾選項目自動計算總價。
        </p>

        <div class="space-y-3">
          <!-- 第一梯次 -->
          <label class="flex items-start gap-3 rounded-2xl bg-indigo-50 border border-indigo-100 px-4 py-3 shadow-sm">
            <input
              type="checkbox"
              name="sessions"
              value="S1"
              class="mt-1 h-4 w-4 accent-indigo-500"
            />
            <div class="flex-1">
              <div class="flex items-baseline justify-between gap-2">
                <p class="text-sm font-semibold text-slate-900">
                  第一梯次：英語故事創作 × 停格動畫導演營
                </p>
                <span class="inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-1 text-xs font-semibold text-indigo-700">
                  NT$ 9,200
                </span>
              </div>
              <p class="mt-1 text-xs text-slate-600">
                建議國小 3–6 年級 · 英語表達 × 劇本創作 × 停格動畫實作。
              </p>
            </div>
          </label>

          <!-- 第二梯次 -->
          <label class="flex items-start gap-3 rounded-2xl bg-indigo-50 border border-indigo-100 px-4 py-3 shadow-sm">
            <input
              type="checkbox"
              name="sessions"
              value="S2"
              class="mt-1 h-4 w-4 accent-indigo-500"
            />
            <div class="flex-1">
              <div class="flex items-baseline justify-between gap-2">
                <p class="text-sm font-semibold text-slate-900">
                  第二梯次：遨遊世界一萬哩：歐洲文化與旅遊英語
                </p>
                <span class="inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-1 text-xs font-semibold text-indigo-700">
                  NT$ 8,350
                </span>
              </div>
              <p class="mt-1 text-xs text-slate-600">
                歐洲城市導覽 × 旅遊情境對話 × 文化小知識。
              </p>
            </div>
          </label>

          <!-- 第三梯次 -->
          <label class="flex items-start gap-3 rounded-2xl bg-indigo-50 border border-indigo-100 px-4 py-3 shadow-sm">
            <input
              type="checkbox"
              name="sessions"
              value="S3"
              class="mt-1 h-4 w-4 accent-indigo-500"
            />
            <div class="flex-1">
              <div class="flex items-baseline justify-between gap-2">
                <p class="text-sm font-semibold text-slate-900">
                  第三梯次：穿越時空：西洋燦爛古文明探索
                </p>
                <span class="inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-1 text-xs font-semibold text-indigo-700">
                  NT$ 8,350
                </span>
              </div>
              <p class="mt-1 text-xs text-slate-600">
                古文明故事 × 歷史地理 × 英文閱讀與簡報表達。
              </p>
            </div>
          </label>
        </div>

        <!-- 前端顯示總價＋傳給後端用的 hidden 欄位 -->
        <div class="mt-4 flex items-center justify-between text-sm">
          <p class="text-slate-300">
            已選擇梯次預估總金額：
            <span id="totalPriceText" class="font-semibold text-emerald-300">
              尚未選擇梯次
            </span>
          </p>
        </div>
        <input type="hidden" name="totalPrice" id="totalPriceInput" value="0" />
      </section>

      <!-- 三、緊急聯絡＆特殊需求 -->
      <section>
        <h2 class="text-xl font-semibold mb-3">三、 緊急聯絡與特殊需求</h2>

        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="block text-sm mb-1">緊急聯絡人姓名（必填）</label>
            <input type="text" name="emergencyName" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">與學員關係（必填）</label>
            <input type="text" name="emergencyRelation" placeholder="父親／母親／監護人…"
                   required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">緊急聯絡人電話（必填）</label>
            <input type="tel" name="emergencyPhone" required
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div>
            <label class="block text-sm mb-1">特殊飲食需求</label>
            <input type="text" name="diet"
                   placeholder="無／素食／某些食物過敏等"
                   class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm" />
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm mb-1">特殊健康狀況／病史</label>
            <textarea name="health"
                      rows="3"
                      placeholder="如：氣喘、癲癇、食物或藥物過敏、舊傷…"
                      class="w-full rounded-lg bg-slate-800 border border-slate-600 px-3 py-2 text-sm"></textarea>
          </div>
        </div>
      </section>

            <!-- 四、條款與同意 -->
      <!-- 四、條款與同意 -->
      <section>
        <h2 class="text-xl font-semibold mb-3">四、 同意條款</h2>

        <div class="space-y-2 text-xs leading-relaxed text-slate-300 max-h-52 overflow-y-auto border border-slate-700 rounded-lg p-3 bg-slate-900/80">
          <p>1. 本報名資料僅供營隊聯繫、分組、辦理團體保險及相關行政作業使用。</p>
          <p>2. 本營隊將為學員投保旅遊平安險或公共意外責任險，若因資料填寫不實或錯誤致影響理賠，概由報名者與監護人自行負責。</p>
          <p>3. 監護人已如實告知學員之健康狀況與不適合進行劇烈活動之疾病。</p>
          <p>4. 報名學員應遵守活動規範，若嚴重妨礙課程進行，主辦單位得取消參加資格，費用恕不退還。</p>
          <p>5. 退費標準：開課前 10 天前全額；前 9–3 天退 80%；前 2 天退 70%；當日或未出席恕不退費。</p>
        </div>

       <!-- ⭐ 必選三選一：拍照/露出設定 -->
        <div class="mt-4 text-sm text-slate-200 space-y-2">
          <p class="font-semibold">活動期間拍攝及照片使用範圍（請擇一）：</p>

          <!-- 1. 可以都拍、可公開使用 -->
          <label class="flex items-start gap-2">
            <input
              type="radio"
              name="photoPermission"
              value="可公開使用"
              class="mt-1 h-4 w-4"
              required
            />
            <span>
              可以拍攝，且可於
              <span class="font-semibold">官方網站、社群媒體等公開管道</span>
              使用學員照片／影像，不需打碼。
            </span>
          </label>

          <!-- 2. 可拍，但公開要打碼 -->
          <label class="flex items-start gap-2">
            <input
              type="radio"
              name="photoPermission"
              value="打碼後可公開"
              class="mt-1 h-4 w-4"
            />
            <span>
              可以拍攝，<span class="font-semibold">若用於網站或社群媒體公開時需打碼或遮擋正臉</span>，
              以避免清楚辨識學員本人。
            </span>
          </label>

          <!-- 3. 只可內部紀錄，不可公開露出 -->
          <label class="flex items-start gap-2">
            <input
              type="radio"
              name="photoPermission"
              value="僅內部紀錄不可公開"
              class="mt-1 h-4 w-4"
            />
            <span>
              僅同意作為<span class="font-semibold">課程紀錄、保險或安全存證等內部用途</span>拍攝，
              <span class="font-semibold">不得於網站、社群媒體等公開露出學員影像</span>。
            </span>
          </label>
        </div>


        <label class="mt-3 flex items-start gap-2 text-sm">
          <input id="agreeTerms" type="checkbox" class="mt-1" required />
          <span>
            我已詳細閱讀並同意以上
            <span class="font-semibold">報名須知、個資、保險條款與退費規定</span>。
          </span>
        </label>
      </section>



      <!-- 送出按鈕 -->
      <div class="pt-2 border-t border-slate-700 flex items-center gap-3">
        <button
          id="submitBtn"
          type="submit"
          class="px-6 py-2.5 rounded-xl bg-pink-500 text-sm font-semibold text-white shadow-lg hover:bg-pink-600 disabled:opacity-40 disabled:cursor-not-allowed">
          送出報名
        </button>
        <span id="loadingText" class="hidden text-xs text-slate-400">
          送出中，請稍候…
        </span>
      </div>
    </form>
  </div>

<script>
  const form = document.getElementById('regForm');
  const submitBtn = document.getElementById('submitBtn');
  const loadingText = document.getElementById('loadingText');
  const agree = document.getElementById('agreeTerms');

  const successView = document.getElementById('successView');
  const nextBtn = document.getElementById('nextBtn');

  const sessionCheckboxes = Array.from(document.querySelectorAll('input[name="sessions"]'));
  const totalPriceText = document.getElementById('totalPriceText');
  const totalPriceInput = document.getElementById('totalPriceInput');
  // 🚀 這裡改成你的 Apps Script URL
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwUAD110dckyhjTintxyJBJf6QxwtLp8S7tEKmck28D7eTtdBUrtH8tZgSWKIh8f_NO/exec';
  // 每個梯次的價錢（前端顯示用，後端還是會再算一次）
  const photoRadios = document.querySelectorAll('input[name="photoPermission"]');
  const photoSelected = Array.from(photoRadios).some(r => r.checked);

  const SESSION_PRICES = {
    S1: 9200,
    S2: 8350,
    S3: 8350
  };

  function updateTotalPrice() {
    let total = 0;
    sessionCheckboxes.forEach(cb => {
      if (cb.checked) {
        total += SESSION_PRICES[cb.value] || 0;
      }
    });

    if (total > 0) {
      totalPriceText.textContent = `NT$ ${total.toLocaleString()}`;
    } else {
      totalPriceText.textContent = '尚未選擇梯次';
    }
    totalPriceInput.value = total;
  }

  sessionCheckboxes.forEach(cb => cb.addEventListener('change', updateTotalPrice));
  updateTotalPrice();

  form.addEventListener('submit', async function (e) {
  e.preventDefault();

  // 至少要選一個梯次
  const anySelected = sessionCheckboxes.some(cb => cb.checked);
  if (!anySelected) {
    alert('請至少選擇一個報名梯次。');
    return;
  }

  // 同意條款檢查
  if (!agree.checked) {
    alert('請先勾選「我已閱讀並同意相關條款」再送出報名。');
    return;
  }

  // ✅ 必選：是否同意拍照/錄影宣傳
  const photoSelected = photoRadios.some(r => r.checked);
  if (!photoSelected) {
    alert('請選擇是否同意拍攝與宣傳使用。');
    return;
  }

  // 顯示送出中 UI
  submitBtn.disabled = true;
  loadingText.classList.remove('hidden');

  try {
    const formData = new FormData(form);

    await fetch(SCRIPT_URL, {
      method: 'POST',
      body: formData,
      mode: 'no-cors'
    });

    form.reset();
    sessionCheckboxes.forEach(cb => (cb.checked = false));
    updateTotalPrice();

    form.classList.add('hidden');
    successView.classList.remove('hidden');
  } catch (err) {
    console.error(err);
    alert('送出時發生問題，請稍後再試一次或聯繫我們。');
  } finally {
    submitBtn.disabled = false;
    loadingText.classList.add('hidden');
  }
});


  // 「填寫下一位」：關掉成功畫面，重新顯示空白表單
  nextBtn.addEventListener('click', () => {
    successView.classList.add('hidden');
    form.classList.remove('hidden');
    submitBtn.disabled = false;
    loadingText.classList.add('hidden');
  });
</script>

</body>
</html>
